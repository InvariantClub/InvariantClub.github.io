<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to monorepo with Nix | Invariant Club</title>
    <meta name="description" content="Reaching development nirvana through Nix">
    <meta name="generator" content="VitePress v1.0.0-rc.35">
    <link rel="preload stylesheet" href="/assets/style.6fioNW3_.css" as="style">
    
    <script type="module" src="/assets/app.SbOiESMr.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.ALnBf2yK.js">
    <link rel="modulepreload" href="/assets/chunks/theme.Hk7OZ9V8.js">
    <link rel="modulepreload" href="/assets/articles_how-to-monorepo-with-nix.md.cW6CTdEj.lean.js">
    <link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Fira+Code&amp;family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&amp;display=swap">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9d8abc1e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9d8abc1e data-v-7ad780c2><div class="VPNavBar has-sidebar" data-v-7ad780c2 data-v-3efcd581><div class="wrapper" data-v-3efcd581><div class="container" data-v-3efcd581><div class="title" data-v-3efcd581><div class="VPNavBarTitle has-sidebar" data-v-3efcd581 data-v-e4cade88><a class="title" href="/" data-v-e4cade88><!--[--><!--]--><!----><!--[-->Invariant Club<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-3efcd581><div class="content-body" data-v-3efcd581><!--[--><!--]--><div class="VPNavBarSearch search" data-v-3efcd581><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-3efcd581 data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/articles.html" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Articles</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/templates/" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Templates</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/faqs.html" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>FAQs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/contact.html" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Contact</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-3efcd581 data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-283b26e9 data-v-d80abb8e data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-d80abb8e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-d80abb8e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-3efcd581 data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/InvariantClub/" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-3efcd581 data-v-8e87c032 data-v-aa8de344><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aa8de344><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-aa8de344><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-aa8de344><div class="VPMenu" data-v-aa8de344 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-8e87c032><div class="item appearance" data-v-8e87c032><p class="label" data-v-8e87c032>Appearance</p><div class="appearance-action" data-v-8e87c032><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8e87c032 data-v-d80abb8e data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-d80abb8e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-d80abb8e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-8e87c032><div class="item social-links" data-v-8e87c032><div class="VPSocialLinks social-links-list" data-v-8e87c032 data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/InvariantClub/" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-3efcd581 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-3efcd581><div class="divider-line" data-v-3efcd581></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-9d8abc1e data-v-b979e4d9><div class="container" data-v-b979e4d9><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b979e4d9><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b979e4d9><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b979e4d9>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b979e4d9 data-v-2744f6e0><button data-v-2744f6e0>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-9d8abc1e data-v-4871f9f5><div class="curtain" data-v-4871f9f5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-4871f9f5><span class="visually-hidden" id="sidebar-aria-label" data-v-4871f9f5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Resources</h2><!----></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/articles.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Articles</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/templates/" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Templates</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/faqs.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>FAQs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/contact.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Contact</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9d8abc1e data-v-3cf691b6><div class="VPDoc has-sidebar has-aside" data-v-3cf691b6 data-v-4e39c852><!--[--><!--]--><div class="container" data-v-4e39c852><div class="aside" data-v-4e39c852><div class="aside-curtain" data-v-4e39c852></div><div class="aside-container" data-v-4e39c852><div class="aside-content" data-v-4e39c852><div class="VPDocAside" data-v-4e39c852 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-cb998dce data-v-6b52fe58><div class="content" data-v-6b52fe58><div class="outline-marker" data-v-6b52fe58></div><div class="outline-title" role="heading" aria-level="2" data-v-6b52fe58>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-6b52fe58><span class="visually-hidden" id="doc-outline-aria-label" data-v-6b52fe58> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-6b52fe58 data-v-53c99d69><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-4e39c852><div class="content-container" data-v-4e39c852><!--[--><!--]--><main class="main" data-v-4e39c852><div style="position:relative;" class="vp-doc _articles_how-to-monorepo-with-nix" data-v-4e39c852><div><!--[--><h1>How to monorepo with Nix</h1><small class="author-info"><img width="50" src="/images/noon.png"> by Noon van der Silk</small><!--]--><h2 id="you-are-standing-in-a-monorepo" tabindex="-1">You are standing in a monorepo ... <a class="header-anchor" href="#you-are-standing-in-a-monorepo" aria-label="Permalink to &quot;You are standing in a monorepo ...&quot;">â€‹</a></h2><div class="language-txt vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span>You&#39;ve read all the articles. You&#39;ve discussed it at length and from all</span></span>
<span class="line"><span>angles. You&#39;ve considered all the tradeoffs. You&#39;ve created the repo and</span></span>
<span class="line"><span>you&#39;re ready to hack ...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&gt; look around</span></span>
<span class="line"><span></span></span>
<span class="line"><span>You feel comfortable surrounded by all the code you will need to achieve</span></span>
<span class="line"><span>your dream. To the left you see a cosy JavaScript project. To your right</span></span>
<span class="line"><span>you see one or more backend codebases. Directly ahead of you are various</span></span>
<span class="line"><span>docker files ready to run all the services you care about.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>You are, of course, standing in a monorepo.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>What do you want to do next?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&gt; ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Perhaps you would like to ...</p><ul><li><em>Run</em> something?</li><li><em>Test</em> something?</li><li><em>Demo</em> something?</li><li><em>Build</em> something?</li><li><em>Fix</em> something?</li><li><em>Break</em> something?!</li></ul><p>Whichever it is, you almost certainly need all of the dependencies of the projects installed and ready to go; at the right version for each project; potentially even with conflicting dependencies, depending on how the lifetime of the particular sub project.</p><p>So, with excitement in our body and optimism in our hearts, let&#39;s get into it.</p><h2 id="nixing-the-monorepo" tabindex="-1">Nixing the monorepo <a class="header-anchor" href="#nixing-the-monorepo" aria-label="Permalink to &quot;Nixing the monorepo&quot;">â€‹</a></h2><h3 id="the-setup" tabindex="-1">The setup <a class="header-anchor" href="#the-setup" aria-label="Permalink to &quot;The setup&quot;">â€‹</a></h3><p>Your particular codebase may differ in languages; but for the purposes of exploring the idea, let&#39;s go with a concrete setup:</p><ol><li>A vuejs-based JavaScript frontend,</li><li>A python project for some data analysis,</li><li>A rust backend,</li><li>A docker-compose file for some database services.</li></ol><p>The scheme will work for however rich an environment you choose to make.</p><h3 id="choices" tabindex="-1">Choices <a class="header-anchor" href="#choices" aria-label="Permalink to &quot;Choices&quot;">â€‹</a></h3><p>Given we&#39;ve agreed to use Nix, we know we&#39;ll be following a <a href="/articles/get-started-nix-flakes.html">flake.nix-style</a> setup.</p><p>But, how should we structure it? It might at first seem obvious to just go with a single big <code>flake.nix</code> file; but we should at least look at the other options:</p><table><thead><tr><th></th><th>1ï¸âƒ£ Single flake.nix</th><th>2ï¸âƒ£ Multiple flake.nix&#39;s</th></tr></thead><tbody><tr><td>ğŸš <strong>Single devShell</strong></td><td>Simple?</td><td>???</td></tr><tr><td>ğŸš ğŸš <strong>Multiple devShells</strong></td><td>Confusing?</td><td>Natural?</td></tr></tbody></table><p>Let&#39;s explore the pros and cons a little bit.</p><ol><li><p>1ï¸âƒ£ ğŸš â€” <strong>Single flake.nix / Single devShell</strong></p><p>This is the most natural idea; especially if you are starting from not having Nix at all. In our example world, we would add nodejs, ruby, python, rust, ... all at once.</p><p><em>Pros:</em></p><ul><li>Simple</li><li>Clear</li><li>Easily run anything at any time</li><li>Shared configuration is easy</li><li>Access to any tool at any time</li><li>Interdependencies easy to express</li></ul><p><em>Cons:</em></p><ul><li>Potential overhead if you never touch certain areas</li><li>Potential for conflict between changes of disconnected areas</li><li>Harder to isolate review requirements</li></ul></li><li><p>2ï¸âƒ£ ğŸš ğŸš â€” <strong>Multiple flake.nix&#39;s / Multiple devShells</strong></p><p>At the other end of the spectrum, if you consider a monorepo as &quot;merely&quot; a place where you put all your (perhaps indepenent) projects, then this idea is very natural: Just consider each project independently; and define the necessary dependencies.</p><p>In our setup, we have maybe ~5 &quot;base&quot; folders; so we could have one <code>flake.nix</code> for each.</p><p><em>Pros</em>:</p><ul><li>Simple</li><li>Best possible isolation: fast hacking, no overlap problems, etc</li><li>&quot;Reversible&quot; - it could look a little like you copy-and-pasted all your independent repos in one big one. Easy to undo.</li></ul><p><em>Cons</em>:</p><ul><li>Lose ability to easily interact with other components</li><li>Potentially lots of redundancy</li></ul></li><li><p>2ï¸âƒ£ ğŸš â€” <strong>Multiple flake.nix&#39;s / Single devShell</strong></p><p>While one <em>could</em> do this, I&#39;m just going to immediately rule it out as not particularly interesting because we can basically interpret it as the same idea as above, but arbitrarily definine one extra top-level flake.nix and a mega devShell.</p></li><li><p>1ï¸âƒ£ ğŸš ğŸš â€” <strong>Single flake.nix / Multiple devShells</strong></p><div class="info custom-block"><p class="custom-block-title">Spoiler</p><p>I&#39;m going to argue for this one. But note that the first two options above are very legitimate; and there&#39;s nothing really wrong with picking them. This one just lets us explore something new, so it&#39;s why we will spend most of our time here!</p></div><p>The idea here would be to define a single top-level <code>flake.nix</code>, but design it in a way for maximum seperation, while allowing re-use. This means potentially a couple of devShells, some conveniences to make sure you always have what you need; but enough isolation to avoid conflicts with changes that you don&#39;t care about at the present moment.</p><p><em>Pros</em>:</p><ul><li>Isolation</li><li>Convenience</li><li>Interdependence</li><li>Freedom to hack where you need</li></ul><p><em>Cons</em>:</p><ul><li>Interdependence</li><li>Not breaking it becomes very important</li><li><em>Can</em> incur overhead</li></ul></li></ol><h2 id="what-it-looks-like" tabindex="-1">What it looks like <a class="header-anchor" href="#what-it-looks-like" aria-label="Permalink to &quot;What it looks like&quot;">â€‹</a></h2><p>If you want to jump straight to the code: <a href="https://github.com/InvariantClub/monorepo-with-nix" target="_blank" rel="noreferrer">InvariantClub/monorepo-with-nix</a>.</p><p>We&#39;ve got the following rough structure (excluding a bunch of busywork files):</p><div class="language-txt vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span>.</span></span>
<span class="line"><span>â”œâ”€â”€ analytics</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ analytics_stuff</span></span>
<span class="line"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ main.py</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ nix</span></span>
<span class="line"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ outputs.nix</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ pyproject.toml</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ uv.lock</span></span>
<span class="line"><span>â”œâ”€â”€ backend</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ nix</span></span>
<span class="line"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ outputs.nix</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ Cargo.toml</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ ...</span></span>
<span class="line"><span>â”œâ”€â”€ flake.nix</span></span>
<span class="line"><span>â”œâ”€â”€ frontend</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ nix</span></span>
<span class="line"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ outputs.nix</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ package.json</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ ...</span></span>
<span class="line"><span>â”œâ”€â”€ infra</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ docker-compose.yaml</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ nix</span></span>
<span class="line"><span>â”‚Â Â      â””â”€â”€ outputs.nix</span></span>
<span class="line"><span>â”œâ”€â”€ nix</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ formatting.nix</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ pkgs.nix</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ serve.nix</span></span>
<span class="line"><span>â””â”€â”€ flake.nix</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>The contents is the following:</p><ul><li><code>./analytics</code>: A uv-based Python project.</li><li><code>./backend</code>: A simple Rust webserver backend (via <a href="https://docs.rs/warp/latest/warp/" target="_blank" rel="noreferrer">warp</a>) with a Cargo.toml</li><li><code>./frontend</code>: A vite-based vuejs frontend</li><li><code>./infra</code>: Docker-based setup</li><li><code>./nix</code>: Project-wide Nix derivations</li></ul><p>In such sub-folder, we also have a <code>./nix</code> folder that gets referrenced in the single top-level <code>flake.nix</code>. This folder defines all the &quot;outputs&quot; for that specific component; i.e. perhaps a <code>package</code> or a <code>devShell</code>.</p><p>For the first three, the <code>outputs.nix</code> is basically exactly what you see in the <code>./nix</code> folder of the respective templates: <a href="https://github.com/InvariantClub/nix-python-uv" target="_blank" rel="noreferrer">nix-python-uv</a>, <a href="https://github.com/InvariantClub/nix-rust" target="_blank" rel="noreferrer">nix-rust</a>, <a href="https://github.com/InvariantClub/nix-js-simple" target="_blank" rel="noreferrer">nix-javascript</a>.</p><p>The more interesting situation happens when you want interdependencies between the projects; so let&#39;s see an example.</p><h3 id="the-frontend-requires-the-backend" tabindex="-1">The frontend requires the backend <a class="header-anchor" href="#the-frontend-requires-the-backend" aria-label="Permalink to &quot;The frontend requires the backend&quot;">â€‹</a></h3><p>It&#39;s pretty natural that the frontend of your app will, at some point, wish to talk to the backend.</p><p>Let&#39;s see the options here.</p><h4 id="option-0-no-backend" tabindex="-1">Option 0. No backend <a class="header-anchor" href="#option-0-no-backend" aria-label="Permalink to &quot;Option 0. No backend&quot;">â€‹</a></h4><p>Probably your app needs to handle when there&#39;s no backend at all. This would just be jumping into the <code>frontend</code> folder and simply running:</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">npm</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> run</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>You&#39;ll perhaps have some errors</p><h4 id="option-1-backend-running-inside-the-devshell" tabindex="-1">Option 1. Backend running <em>inside</em> the devShell <a class="header-anchor" href="#option-1-backend-running-inside-the-devshell" aria-label="Permalink to &quot;Option 1. Backend running _inside_ the devShell&quot;">â€‹</a></h4><ol><li><code>cd backend &amp;&amp; cargo run</code></li><li><code>cd frontend &amp;&amp; npm run dev</code> ...</li></ol><p>This is natural. You run the backend first in some terminal, then you run the frontend.</p><p>This is especially convenient if you&#39;re iterating on both at the same time; but perhaps is a little bit annoying if you <em>just</em> want to iterate on the frontend. It also becomes quadratically more annoying if you have more than one service to coordinate. You need to make sure that everything matches up (with environment variables, etc.)</p><p>So, this remains possible here, but is only recommended when specifically hacking on both services.</p><h4 id="option-2-use-process-compose" tabindex="-1">Option 2. Use <a href="https://github.com/F1bonacc1/process-compose" target="_blank" rel="noreferrer">process-compose</a> <a class="header-anchor" href="#option-2-use-process-compose" aria-label="Permalink to &quot;Option 2. Use [process-compose](https://github.com/F1bonacc1/process-compose)&quot;">â€‹</a></h4><p>We&#39;ve defined <a href="https://github.com/InvariantClub/monorepo-with-nix/blob/main/nix/serve.nix#L26" target="_blank" rel="noreferrer">process-compose</a> setup in <code>serve.nix</code> that runs the backand and frontend together.</p><p>You can run both like:</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">nix</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> run</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> .#serve</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Or, <em>just</em> the backend like:</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">nix</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> run</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> .#serve</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> --</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> run</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> backend</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>One advantage here is that, with proper caching, you won&#39;t need to do any rebuilding if you&#39;re not actually hacking on the backend. But perhaps more importantly, it&#39;s typical that any given setup requires <em>many</em> backend services: a database, a queue, etc, etc. These can all be specified in the process-compose style, to make for a very convenient way of spinning up what&#39;s necessary.</p><h4 id="option-3-use-docker-compose" tabindex="-1">Option 3. Use docker compose <a class="header-anchor" href="#option-3-use-docker-compose" aria-label="Permalink to &quot;Option 3. Use docker compose&quot;">â€‹</a></h4><p>A more typical setup would have you use a <code>docker-compose.yaml</code> file that perhaps builds docker images from the source directly; or otherwise obtains images for various services and spins up all (or part) of the environment.</p><p>While this can be effective; unless done in a very careful way, it&#39;s very easy for rebuilds to take a very long time; and depending on your world, you can even forget to rebuild and face annoyances about not using the right version of the image, etc.</p><p>Nevertheless, it can still be very useful to integrate with this style; if only because it allows for gradual adoption.</p><p>For that reason, we provide a docker compose configuration file; but more interestingly, in <code>infra/outputs.nix</code> we provide Nix derivations that <em>actually</em> build docker images!</p><p>The image for the rust backend is so concise that we can repeat it entirely here:</p><div class="language-nix vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nix</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#616E88;"># ./infra/nix/outputs.nix</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">...</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">packages</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">backend-image</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;"> pkgs</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">dockerTools</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">streamLayeredImage</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">  name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;"> &quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;">monorepo-with-nix-</span><span style="--shiki-light:#22863A;--shiki-dark:#81A1C1;">${</span><span style="--shiki-light:#22863A;--shiki-dark:#D8DEE9;">self&#39;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#22863A;--shiki-dark:#D8DEE9;">packages</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#22863A;--shiki-dark:#D8DEE9;">backend</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#22863A;--shiki-dark:#D8DEE9;">pname</span><span style="--shiki-light:#22863A;--shiki-dark:#81A1C1;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;">&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">  tag</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;"> &quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;">latest</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;">&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">  created</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;"> &quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;">now</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;">&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">  contents</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> [</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;"> self&#39;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">packages</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">backend</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> ]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">  config</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#8FBCBB;">    Entrypoint</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;"> &quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;">backend</span><span style="--shiki-light:#22863A;--shiki-dark:#ECEFF4;">&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;"> ]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;">  }</span><span style="--shiki-light:#24292EFF;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Then, you can build the image with:</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">nix</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> build</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> .#backend-image</span><span style="--shiki-light:#212121;--shiki-dark:#ECEFF4;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;"> ./result</span><span style="--shiki-light:#D32F2F;--shiki-dark:#81A1C1;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;"> docker</span><span style="--shiki-light:#2B5581;--shiki-dark:#A3BE8C;"> load</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>In any setting, it&#39;s very useful to have a docker image for whatever you wish to deploy; and here, we use these images directly in the <code>docker-compose.yaml</code> file:</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes min-light nord vp-code"><code><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-dark:#616E88;"># docker-compose.yaml</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#8FBCBB;">services</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ECEFF4;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#8FBCBB;">  backend</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ECEFF4;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#8FBCBB;">    image</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ECEFF4;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;"> monorepo-with-nix-backend</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#8FBCBB;">    ports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ECEFF4;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ECEFF4;">      -</span><span style="--shiki-light:#22863A;--shiki-dark:#A3BE8C;"> 3030:3030</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D8DEE9FF;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>and that&#39;s it! You can interact with this in the normal way you would any docker service. But do not forget to rebuild the image on any code change! Note that the rebuild requirement means this isn&#39;t as joyful as the other three options, but may still be useful to have around to support certain use-cases.</p><h3 id="interdepdenencies" tabindex="-1">Interdepdenencies <a class="header-anchor" href="#interdepdenencies" aria-label="Permalink to &quot;Interdepdenencies&quot;">â€‹</a></h3><p>The main benefit of a unified Nix representation, is how easy it is to express interdependencies. In fact, if the baseline is that your project is already nixified as a flake; it&#39;s actually very easy to do. The only downside is, as is often the case, things become annoying when you&#39;re doing development on all the different places at once.</p><p>Here, this is immediately addressed; because all the definitions are available, and anything that needs to be changed or accessed can be.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">â€‹</a></h2><p>Here we&#39;ve presented a concrete example of how to set up a &quot;monorepo&quot; style environment using Nix: <a href="https://github.com/InvariantClub/monorepo-with-nix" target="_blank" rel="noreferrer">InvariantClub/monorepo-with-nix</a>.</p><p>We&#39;ve shown a couple of different other options; and that all have interesting options and drawbacks.</p><p>Hopefully this gives you some food for thought!</p><article id="reach-out"><h3> ğŸ‘‹ğŸ» Hello! </h3><div><p> I&#39;d be very happy to help you on your Nix journey. If you&#39;re inspired, intrigued, stuck, or otherwise keen to make some progress, then please do get in <a href="/contact">contact</a> :) </p></div></article></div></div></main><footer class="VPDocFooter" data-v-4e39c852 data-v-b4b63abf><!--[--><!--]--><!----><nav class="prev-next" data-v-b4b63abf><div class="pager" data-v-b4b63abf><a class="VPLink link pager-link prev" href="/articles/packaging-128-programming-languages-with-nix.html" data-v-b4b63abf><!--[--><span class="desc" data-v-b4b63abf>Previous page</span><span class="title" data-v-b4b63abf>Packaging 128 languages with Nix</span><!--]--></a></div><div class="pager" data-v-b4b63abf><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-9d8abc1e data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>Built with love â¤ï¸ on our one and only planet ğŸŒ :)</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"templates_index.md\":\"cjUhzrpW\",\"contact.md\":\"5OBWNjyA\",\"index.md\":\"22IGUM__\",\"articles.md\":\"7P-hR6J4\",\"articles_why-should-my-project-adopt-nix.md\":\"lcnlBgnn\",\"articles_how-to-monorepo-with-nix.md\":\"cW6CTdEj\",\"articles_packaging-128-programming-languages-with-nix.md\":\"BLa5wZf6\",\"articles_get-started-nix-flakes.md\":\"tXYbMalz\",\"faqs.md\":\"VxYv1wf4\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Invariant Club\",\"description\":\"Reaching development nirvana through Nix\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"search\":{\"provider\":\"local\",\"options\":{\"disableDetailedView\":true,\"disableQueryPersistence\":true}},\"nav\":[{\"text\":\"Articles\",\"link\":\"/articles\"},{\"text\":\"Templates\",\"link\":\"/templates/\"},{\"text\":\"FAQs\",\"link\":\"/faqs\"},{\"text\":\"Contact\",\"link\":\"/contact\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/InvariantClub/\"}],\"sidebar\":{\"/articles\":[{\"text\":\"Resources\",\"items\":[{\"text\":\"Articles\",\"link\":\"/articles\"},{\"text\":\"Templates\",\"link\":\"/templates/\"},{\"text\":\"FAQs\",\"link\":\"/faqs\"},{\"text\":\"Contact\",\"link\":\"/contact\"}]}],\"/templates/\":[{\"text\":\"Resources\",\"items\":[{\"text\":\"Articles\",\"link\":\"/articles\"},{\"text\":\"Templates\",\"link\":\"/templates/\"},{\"text\":\"FAQs\",\"link\":\"/faqs\"},{\"text\":\"Contact\",\"link\":\"/contact\"}]}],\"/faqs\":[{\"text\":\"Resources\",\"items\":[{\"text\":\"Articles\",\"link\":\"/articles\"},{\"text\":\"Templates\",\"link\":\"/templates/\"},{\"text\":\"FAQs\",\"link\":\"/faqs\"},{\"text\":\"Contact\",\"link\":\"/contact\"}]}],\"/contact\":[{\"text\":\"Resources\",\"items\":[{\"text\":\"Articles\",\"link\":\"/articles\"},{\"text\":\"Templates\",\"link\":\"/templates/\"},{\"text\":\"FAQs\",\"link\":\"/faqs\"},{\"text\":\"Contact\",\"link\":\"/contact\"}]}]},\"footer\":{\"message\":\"Built with love â¤ï¸ on our one and only planet ğŸŒ :)\"},\"lastUpdated\":false,\"lastUpdatedText\":\"Updated on\"},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>